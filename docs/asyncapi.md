# Verona Inferfaces Specification "Player" 5.0.0 documentation

* License: [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)
* Support: [Institute for Educational Quality Improvement (IQB)](https://www.iqb.hu-berlin.de)
* Email support: [iqb-tbadev@hu-berlin.de](mailto:iqb-tbadev@hu-berlin.de)

This is one part of the Verona Online Assessment Standards. All messages are sent via the postMessage function of the html page. The player takes the page root of its parent as target (parent.window), and the application binds the function call to the iframe element of the player.
Most importantly, the message body carries as first parameter the operationId of the message.
The html page MUST contain a <script>-tag with metadata. The syntax and structure of this data are described [here](https://github.com/verona-interfaces/metadata/#readme).

## Table of Contents

* [Operations](#operations)
  * [SUB vopReadyNotification](#sub-vopreadynotification-operation)
  * [PUB vopStartCommand](#pub-vopstartcommand-operation)
  * [SUB vopStateChangedNotification](#sub-vopstatechangednotification-operation)
  * [PUB vopPageNavigationCommand](#pub-voppagenavigationcommand-operation)
  * [SUB vopUnitNavigationRequestedNotification](#sub-vopunitnavigationrequestednotification-operation)
  * [PUB vopNavigationDeniedNotification](#pub-vopnavigationdeniednotification-operation)
  * [SUB vopWindowFocusChangedNotification](#sub-vopwindowfocuschangednotification-operation)

## Operations

### SUB `vopReadyNotification` Operation

*Ready Notification*

* Operation ID: `vopReadyNotification`

The player announces that it's code is loaded and initialized so the communication can start.

#### Message `<anonymous-message-1>`

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| metadata | string | Via this property, the player sends the stringified metadata object definied as json-ld in the header of the html file. See [here](https://github.com/verona-interfaces/metadata/#readme) for more information. | - | - | **required** |

> Examples of payload _(generated)_

```json
{
  "metadata": "string"
}
```



### PUB `vopStartCommand` Operation

*Start Command*

* Operation ID: `vopStartCommand`

The application sends parameters for running the unit and commands the start of user interaction.

#### Message `<anonymous-message-2>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the player hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| unitDefinition | string | The definition of the unit (if given) lets the player adapt. An audio player gets it's audio sequence, a choice player gets it's options... | - | format (`byte`) | - |
| unitDefinitionType | string | This lets the player the unit definition format know. This might avoid UI mess after getting old definitions. | - | - | - |
| unitState | object | If there is any state what should be restored, then this is the information for that. | - | - | **additional properties are allowed** |
| unitState.dataParts | object | This data is used by the player to restore the former response state and by data processing systems to analyse the responses. The host must buffer all data parts, because the player might send only changed data parts, not always the whole package. The host stores all parts but only the last given version (respect timeStamp!). Every data part is identified by a unique key, the data is stored as serialized object (string). | - | - | - |
| unitState.dataParts (additional properties) | string | - | - | format (`byte`) | - |
| unitState.presentationProgress | string | This reports the progress of presentation of unit content. The host can enable or disable the navigation to the next unit depending on that value. For example, all audio elements are required to be played or all pages must be presented to the page bottom. This way, giving no response to an item is always intended. | allowed (`"none"`, `"some"`, `"complete"`) | - | - |
| unitState.responseProgress | string | This reports the progress of responding. The host can enable or disable the navigation to the next unit depending on that value. The value 'complete' announces not only that all required responses are given but that these responses are valid too. The value 'complete' can be sent even not all responses are given - the host is interested only in REQUIRED responses. So make sure to mark all response elements correctly corresponding to this behaviour. | allowed (`"none"`, `"some"`, `"complete"`) | - | - |
| unitState.unitStateDataType | string | This string specifies the format of the data stored in dataParts (value). Every transformation or analysis of stored unit data requires knowledge about the format. When the host sends data to the player to restore the former unit state, the player should check the given data type to avoid data mess after getting an old data type. | - | - | - |
| playerConfig | object | This data supplies some information or instruction about this specific run of the unit (number, unit title, some behavioral data for the player). | - | - | **additional properties are allowed** |
| playerConfig.unitNumber | integer | The player might show the numbering of the current unit to ease the navigation. | - | >= 1 | - |
| playerConfig.unitTitle | string | The player might show the title of the current unit. Unless the unit definition could consist of a title, the host might decide to change the title. For example, this is necessary if one unit appears more then once in a booklet. | - | <= 50 characters | - |
| playerConfig.unitId | string | The player might include the internal unit id in state variables or logs. | - | <= 20 characters | - |
| playerConfig.logPolicy | string | The host expects the player to send no logs, only important logs, all possible logs or even logs for debugging purposes. This is a guideline. The player can decide what exactly the logging consists of. | allowed (`"disabled"`, `"lean"`, `"rich"`, `"debug"`) | - | - |
| playerConfig.pagingMode | string | If the player makes it optional, then the page presentation can be changed by the host. The pages are presented separately, concatenated to one big page or concatenated in snap mode (scrolling vertically, but only one page is visible at a time). | allowed (`"separate"`, `"concat-scroll"`, `"concat-scroll-snap"`) | - | - |
| playerConfig.enabledNavigationTargets | array<string> | This lets the player know, what navigation target is enabled to natigate to. The player might then alter the presentation of responding buttons. | - | - | - |
| playerConfig.enabledNavigationTargets (single item) | string | This enumeration lists all possible targets the player could send a navigation request for, relative to the position of the current unit. This could be the next and previous unit, last and first unit of the current range of units (booklet, testlet) or the end of the test. The ending is seen as kind of termination of test, e. g. the announcement of the testee, that all responses are given. What exactly the host will navigate to depends of the nature of the test or the use case and might depend on configuration parameters of the specific booklet as well. | allowed (`"next"`, `"previous"`, `"first"`, `"last"`, `"end"`) | - | - |
| playerConfig.startPage | string | This requests the player to navigate to a certain page after loading. The host might know this page id from former usages of the unit. | - | - | - |
| playerConfig.directDownloadUrl | string | After starting the player and loading the unit definition and former responses, it might be necessary to load additional code or data from the server. This data is identified by an resource ID (usually a file name). The player can download this resource by itself without further interaction with the host frontend. The property directDownloadUrl provides the url for download. The player extends this url by an url separator "/" and the resource ID (uri-encoded if needed). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "unitDefinition": "iqb-scripted::1.4.0 title::Testscript Title2??Hilfetext2 multiple-choice::mc_var1::1::Multiple Choice Feld: ::Choice1##Choice2##Choice3??Hilfetext1 drop-down::dd_var1::1::Dropdown Feld: ::Choice1##Choice2##Choice3??Hilfetext1 checkbox::check_var1::0::Ja klick mal! if-start::dd_var1::1 input-text::jajaj::sap osjxapsoxa if-else input-text::jajaj22::sap osjxapsoxa UUUU text::NOT Choice1 if-end",
  "unitDefinitionType": "iqb-scripted@1.4.0",
  "unitState": {
    "dataParts": {
      "page1": "{\"a\": 1, \"b\": 233}",
      "page2": "{\"c\": \"sehr gut!\", \"d\": true}"
    },
    "presentationProgress": "none",
    "responseProgress": "some",
    "unitStateDataType": "iqb-standard@2.1.2"
  },
  "playerConfig": {
    "unitNumber": "14",
    "unitTitle": "Ein wunderbarer Ausflug",
    "unitId": "M24093EX",
    "logPolicy": "lean",
    "pagingMode": "concat-scroll",
    "enabledNavigationTargets": [
      "next"
    ],
    "startPage": "page5",
    "directDownloadUrl": "https://www.iqb-testcenter.de/download/iskeid-34e845-didmmemdkek"
  }
}
```



### SUB `vopStateChangedNotification` Operation

*State Changed Notification*

* Operation ID: `vopStateChangedNotification`

The state of the unit and/or of the player has changed. Some logs entries might be sent.

#### Message `<anonymous-message-3>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the player hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| timeStamp | string | Ensures, that later arriving states are ignored. | - | format (`date-time`) | **required** |
| unitState | object | To be stored, evaluated etc. This is the main yield, the responses. | - | - | **additional properties are allowed** |
| unitState.dataParts | object | This data is used by the player to restore the former response state and by data processing systems to analyse the responses. The host must buffer all data parts, because the player might send only changed data parts, not always the whole package. The host stores all parts but only the last given version (respect timeStamp!). Every data part is identified by a unique key, the data is stored as serialized object (string). | - | - | - |
| unitState.dataParts (additional properties) | string | - | - | format (`byte`) | - |
| unitState.presentationProgress | string | This reports the progress of presentation of unit content. The host can enable or disable the navigation to the next unit depending on that value. For example, all audio elements are required to be played or all pages must be presented to the page bottom. This way, giving no response to an item is always intended. | allowed (`"none"`, `"some"`, `"complete"`) | - | - |
| unitState.responseProgress | string | This reports the progress of responding. The host can enable or disable the navigation to the next unit depending on that value. The value 'complete' announces not only that all required responses are given but that these responses are valid too. The value 'complete' can be sent even not all responses are given - the host is interested only in REQUIRED responses. So make sure to mark all response elements correctly corresponding to this behaviour. | allowed (`"none"`, `"some"`, `"complete"`) | - | - |
| unitState.unitStateDataType | string | This string specifies the format of the data stored in dataParts (value). Every transformation or analysis of stored unit data requires knowledge about the format. When the host sends data to the player to restore the former unit state, the player should check the given data type to avoid data mess after getting an old data type. | - | - | - |
| playerState | object | Information important only for the application to ensure the correct visual, such as navigation buttons. | - | - | **additional properties are allowed** |
| playerState.validPages | object | This data is structured as "page key" => "page label", so we have (1) keys for navigation commands or state notifications and (2) strings as labels of navigation buttons if needed. | - | - | - |
| playerState.validPages (additional properties) | string | - | - | - | - |
| playerState.currentPage | string | Key of the page currently presented. This key is taken from the list of valid pages. If the paging mode is 'concat-scroll', the first page with parts in view port is taken as current page. | - | - | - |
| log | array<object> | Log entries (lean version) add some information to the response in order to understand the response process better or (rich version) let the analyst replay every change of the state. | - | - | - |
| log.timeStamp | string | - | - | format (`date-time`) | **required** |
| log.key | string | This key might help to classify the events afterwards. | - | - | **required** |
| log.content | string | Some information to specify the event. | - | format (`byte`) | - |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "timeStamp": "2021-11-15T10:22:25Z",
  "unitState": {
    "dataParts": {
      "page1": "{\"a\": 1, \"b\": 233}",
      "page2": "{\"c\": \"sehr gut!\", \"d\": true}"
    },
    "presentationProgress": "none",
    "responseProgress": "some",
    "unitStateDataType": "iqb-standard@2.1.2"
  },
  "playerState": {
    "validPages": {
      "page1": "Seite 1",
      "page2": "Seite 2"
    },
    "currentPage": "page4"
  },
  "log": [
    {
      "timeStamp": "2021-11-15T10:22:25Z",
      "key": "UNIT_NAVIGATION_FAILED",
      "content": "{\"unitId\": \"M24093EX\", \"reason\": \"responsesIncomplete\"}"
    }
  ]
}
```



### PUB `vopPageNavigationCommand` Operation

*Page Navigation Command*

* Operation ID: `vopPageNavigationCommand`

The application wants the player to navigate to a specific page.

#### Message `<anonymous-message-4>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the player hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| target | string | Id of the page matching one of the validPages given to the application by the playerState data of the StateChangedNotification. | - | - | **required** |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "target": "page4"
}
```



### SUB `vopUnitNavigationRequestedNotification` Operation

*Unit Navigation Requested Notification*

* Operation ID: `vopUnitNavigationRequestedNotification`

The user has triggered a navigation request.

#### Message `<anonymous-message-5>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the player hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| target | string | This enumeration lists all possible targets the player could send a navigation request for, relative to the position of the current unit. This could be the next and previous unit, last and first unit of the current range of units (booklet, testlet) or the end of the test. The ending is seen as kind of termination of test, e. g. the announcement of the testee, that all responses are given. What exactly the host will navigate to depends of the nature of the test or the use case and might depend on configuration parameters of the specific booklet as well. | allowed (`"next"`, `"previous"`, `"first"`, `"last"`, `"end"`) | - | **required** |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "target": "next"
}
```



### PUB `vopNavigationDeniedNotification` Operation

*Navigation Denied Notification*

* Operation ID: `vopNavigationDeniedNotification`

The host lets the player know that a navigation request was denied due to player state.

#### Message `<anonymous-message-6>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the player hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| reason | array<string> | This optional parameter explains the reason for the failed attempt to navigate. The player can visualise the problem to the testee. For example, all required but empty input elements get a red border or the message 'please scroll down' is presented. | - | - | - |
| reason (single item) | string | - | allowed (`"presentationIncomplete"`, `"responsesIncomplete"`) | - | - |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "reason": [
    "presentationIncomplete"
  ]
}
```



### SUB `vopWindowFocusChangedNotification` Operation

*Window Focus Changed Notification*

* Operation ID: `vopWindowFocusChangedNotification`

In some use cases like exam mode the host must know whether the host or the player has the window's focus. If none of these windows have the focus (i. e. the testee has left the test), some logging or warning could be necessary. The player should listen to the window events 'blur' and 'focus'.

#### Message `<anonymous-message-7>`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| timeStamp | string | Ensures, that later arriving states are ignored. | - | format (`date-time`) | **required** |
| hasFocus | boolean | true if the player got the focus, false if it lost the focus. | - | - | **required** |

> Examples of payload _(generated)_

```json
{
  "timeStamp": "2021-11-15T10:22:25Z",
  "hasFocus": true
}
```



